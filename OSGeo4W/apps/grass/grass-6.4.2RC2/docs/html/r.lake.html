<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>GRASS GIS manual: r.lake</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="grassdocs.css" type="text/css">
</head>
<body bgcolor="white">

<img src="grass_logo.png" alt="GRASS logo"><hr align=center size=6 noshade>

<h2>NAME</h2>
<em><b>r.lake</b></em>  - Fills lake from seed at given level.
<h2>KEYWORDS</h2>
raster, hydrology
<h2>SYNOPSIS</h2>
<b>r.lake</b><br>
<b>r.lake help</b><br>
<b>r.lake</b> [-<b>no</b>] <b>dem</b>=<em>name</em> <b>wl</b>=<em>float</em>  [<b>lake</b>=<em>name</em>]   [<b>xy</b>=<em>east,north</em>]   [<b>seed</b>=<em>name</em>]   [--<b>overwrite</b>]  [--<b>verbose</b>]  [--<b>quiet</b>] 

<h3>Flags:</h3>
<DL>
<DT><b>-n</b></DT>
<DD>Use negative depth values for lake raster map</DD>

<DT><b>-o</b></DT>
<DD>Overwrite seed map with result (lake) map</DD>

<DT><b>--overwrite</b></DT>
<DD>Allow output files to overwrite existing files</DD>
<DT><b>--verbose</b></DT>
<DD>Verbose module output</DD>
<DT><b>--quiet</b></DT>
<DD>Quiet module output</DD>
</DL>

<h3>Parameters:</h3>
<DL>
<DT><b>dem</b>=<em>name</em></DT>
<DD>Name of terrain raster map (DEM)</DD>

<DT><b>wl</b>=<em>float</em></DT>
<DD>Water level</DD>

<DT><b>lake</b>=<em>name</em></DT>
<DD>Name for output raster map with lake</DD>

<DT><b>xy</b>=<em>east,north</em></DT>
<DD>Seed point coordinates</DD>

<DT><b>seed</b>=<em>name</em></DT>
<DD>Name of raster map with seed (at least 1 cell &gt; 0)</DD>

</DL>
<h2>DESCRIPTION</h2>

<p>The module fills a lake to a target water level from a given start point. The user
can think of it as <em>r.grow</em> with additional checks for elevation.  The resulting
raster map contains cells with values representing lake depth and NULL for all other 
cells beyond the lake.

<p>This module uses a 3x3 moving window approach to find all cells that
match three criteria and to define the lake:

</ul>
 <li>cells are below the specified elevation (i.e., water level);</li>
 <li>cells are connected with an initial cell (seed or E,N value);</li>
 <li>cells are not NULL or masked.</li>
</ul>


<p>The water level must be in DEM units.

<h2>NOTES</h2>

The seed (starting) point can be a raster map with at least one
cell value greater than zero, or a seed point can be specified as an E,
N coordinate pair. If the seed is specified as a coordinate pair, an additional
check is done to make sure that the target water level is above the level of 
the DEM. When a raster map is used as a seed, however, no such checks are done. 
Specifying a target water level below surface represented by DEM will result in an 
empty map. Note: a raster lake map created in a previous run can also be used
as a seed map for a new run to simulate rising water levels.

<p>

The module will create a new map (<b>lake=foo</b>) or can be set to replace
the input (<b>seed=bar</b>) map if the <b>-o</b> flag is used.  The user can use
<b>-o</b> flag to create animations of rising water level without
producing a separate map for each frame.  An initial seed map must be created 
to start the sequence, and will be overwritten during subsequent runs with resulting
water levels maps (i.e., a single file serves for both input and output).

<p>

Negative output (the <b>-n</b> flag) is useful for visualisations in NVIZ. 
It equals the mapcalc's expression <em>"negative = 0 - positive"</em>.

<h3>MAPCALC EQUIVALENT - FOR GRASS HACKERS</h3>

This module was initially created as a script using
<em>r.mapcalc</em>. This had some limitations - it was slow and no
checks where done to find out required iteration count. The shell script 
code (using <em>r.mapcalc</em>) used in the original script is shown below:

<div class="code"><pre>
${seedmap} = if( ${dem}, \
if( if( isnull(${seedmap}),0,${seedmap}>0), ${wlevel}-${dem}, \
 if( \
  if(isnull(${seedmap}[-1,0]),0, ${seedmap}[-1,0]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[-1,1]),0, ${seedmap}[-1,1]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[0,1]), 0, ${seedmap}[0,1]>0  && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[1,1]), 0, ${seedmap}[1,1]>0  && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[1,0]), 0, ${seedmap}[1,0]>0  && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[1,-1]),0, ${seedmap}[1,-1]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[0,-1]),0, ${seedmap}[0,-1]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[-1,-1]),0, ${seedmap}[-1,-1]>0 && ${wlevel}>${dem}),\
 ${wlevel}-${dem}, null() )))
</pre></div>

The ${seedmap} variable is replaced by seed map names, ${dem} with DEM map name, and
${wlevel} with target water level.  To get single water level, this code block is
called with same level numerous times (in a loop) as the lake grows by single cells
during single run.

<h2>BUGS/KNOWN ISSUES</h2>

</ul>
  <li>The entire map is loaded into RAM.</li>
  <li>The module is NOT large file safe. (due to the previous point)</li>
  <li>A completely negative seed map will not work! At least one cell must have 
  a value >0. Output from <em>r.lake -n</em> can NOT be used as input in the next run.</li>
</ul>

<h2>SEE ALSO</h2>

<em><a href="r.mapcalc.html">r.mapcalc</a>,
<a href="r.grow.html">r.grow</a>,
<a href="r.plane.html">r.plane</a></em>

<h2>AUTHOR</h2>
Maris Nartiss (maris.nartiss gmail.com)

<p><i>Last changed: $Date: 2011-11-08 12:29:50 +0100 (Ãºt, 08 XI 2011) $</i>
<HR>
<P><a href="index.html">Main index</a> - <a href="raster.html">raster index</a> - <a href="full_index.html">Full index</a></P>
<P>&copy; 2003-2011 <a href="http://grass.osgeo.org">GRASS Development Team</a></p>
</body>
</html>
