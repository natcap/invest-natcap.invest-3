{
    "id" : "window",
    "label": "Nutrient",
    "targetScript" : "invest_natcap.nutrient.nutrient",
    "modelName" : "nutrient",
    "localDocURI": "../documentation/waterpurification.html",
    "height": 900,
    "width" : 900,
    "elements": [
        {
            "id" : "workspace_list",
            "type": "list",
            "elements":[
		{
		    "id" : "workspace",
		    "args_id" : "workspace_dir",
		    "type": "folder",
		    "label": "Workspace",
		    "defaultValue": "../Nutrient_Retention",
		    "required": true,
                    "helpText":"This is the directory in which the output and intermediate files will be saved."
		},
                {
                    "id" : "results_suffix",
                    "args_id" : "results_suffix",
                    "type": "text",
                    "dataType": "string",
                    "validText": "[a-zA-Z0-9]*",
                    "label": "Results Suffix (optional)",
                    "defaultValue": "",
                    "returns": {"ifEmpty": "pass"},
                    "required": false,
                    "helpText":"This text will be appended to the end of the output files to help separate multiple runs."
                },
		{
		    "id" : "dem_uri",
		    "args_id" : "dem_uri",
		    "type": "file",
		    "label": "DEM Raster",
		    "defaultValue": "../Base_Data/Freshwater/dem",
		    "required": true,
		    "validateAs": {"type": "GDAL"},
		    "helpText": "A GIS raster dataset with an elevation value for each cell. Make sure the DEM is corrected by filling in sinks, and if necessary burning hydrographic features into the elevation model (recommended when you see unusual streams.) See the Working with the DEM section of the InVEST user's guide for more information."
		},
		{
                    "id" : "precipitation",
                    "args_id" : "precipitation_uri",
                    "type": "file",
                    "label": "Precipitation",
                    "defaultValue": "../Base_Data/Freshwater/precip",
                    "required": true,
                    "validateAs": {"type": "GDAL"}
                },
                {
                    "id" : "potential_evapotranspiration",
                    "args_id" : "eto_uri",
                    "type": "file",
                    "label": "Potential Evapotranspiration",
                    "defaultValue": "../Base_Data/Freshwater/eto",
                    "required": true,
                    "validateAs": {"type": "GDAL"}
                },
                {
                    "id" : "soil_depth",
                    "args_id" : "soil_depth_uri",
                    "type": "file",
                    "label": "Depth To Root Restricting Layer",
                    "defaultValue": "../Base_Data/Freshwater/depth_to_root_rest_layer",
                    "required": true,
                    "validateAs": {"type": "GDAL"}
                },
                {
                    "id" : "plant_available_water_fraction",
                    "args_id" : "pawc_uri",
                    "type": "file",
                    "label": "Plant Available Water Fraction",
                    "defaultValue": "../Base_Data/Freshwater/pawc",
                    "required": true,
                    "validateAs": {"type": "GDAL"}
                },
                {
                    "id" : "land_use",
                    "args_id" : "lulc_uri",
                    "type": "file",
                    "label": "Land Use",
                    "defaultValue": "../Base_Data/Freshwater/landuse_90",
                    "required": true,
                    "validateAs": {"type": "GDAL"}
                },
                {
                    "id" : "seasonality_constant",
                    "args_id" : "seasonality_constant",
                    "type": "text",
                    "label": "Seasonality Constant",
                    "defaultValue": "5",
                    "required": true,
                    "validText": "^[0-9]+\\.?[0-9]+$"
                },
		{
		    "id" : "watersheds_uri",
		    "args_id" : "watersheds_uri",
		    "type": "file",
		    "label": "Watershed Polygons",
		    "defaultValue": "../Base_Data/Freshwater/watersheds.shp",
		    "required": true,
		    "validateAs": {"type": "OGR",
				   "layers": [{"name": {"inheritFrom": "file"}, 
					       "type": "polygons",
					       "projection": {"exists": true}
					      }],
				   "fieldsExist": ["ws_id"]
				  },
		    "helpText": "This is a layer of watersheds such that each watershed contributes to a point of interest where water quality will be analyzed.  It must have the integer field 'ws_id' where the values uniquely identify each watershed."
		},
                {
                   "id" : "sub_watersheds",
                   "args_id": "sub_watersheds_uri",
                   "type": "file",
                   "label": "Sub-Watersheds",
                   "defaultValue": "../Base_Data/Freshwater/subwatersheds.shp",
                   "required": false,
                   "validateAs": {"type": "OGR", 
                                  "layers": [{"name": {"inheritFrom": "file"}, 
                                              "type": "polygons",
				       "projection": {"exists": true}
                                            }],
                                  "fieldsExist": ["subws_id"]
                                  }
                },
		{
		    "id" : "biophysical_table_uri",
		    "args_id" : "biophysical_table_uri",
		    "type": "file",
		    "label": "Biophysical Table",
		    "defaultValue": "../WP_Nutrient_Retention/Input/water_biophysical_table.csv",
		    "required": true,
		    "validateAs": {"type": "CSV",
				  "fieldsExist": ["lucode", "etk", "root_depth"],
                                    "restrictions": [{"field": "lucode",
                                                    "validateAs":{"type": "number",
                                                                  "allowedValues": {"pattern":"^[0-9]+$"}
                                                                  }},
                                                     {"field": "etk",
                                                      "validateAs": {"type": "number",
                                                                     "allowedValues":{"pattern":"^[-+]?[0-9]*\\.?[0-9]+$"}
                                                                     }},
                                                     {"field": "root_depth",
                                                      "validateAs": {"type": "number",
                                                                     "allowedValues":{"pattern":"^[-+]?[0-9]*\\.?[0-9]+$"}
                                                                     }}]},
		    "helpText": "A table containing model information corresponding to each of the land use classes in the LULC raster input. It must contain the fields 'lucode', then 'load_n' (or p), 'eff_n' (or p), depending on which nutrients are selected."
		},
		{
		    "id" : "calc_p",
		    "args_id": "calc_p",
		    "type": "checkbox",
		    "label": "Calculate phosphorous retention",
		    "defaultValue": false,
		    "required": false,
		    "helpText": "Select to simulate phosphorous."
		},
		{
		    "id" : "calc_n",
		    "args_id": "calc_n",
		    "type": "checkbox",
		    "label": "Calculate nitrogen retention",
		    "defaultValue": false,
		    "required": false,
		    "helpText": "Select to simulate nitrogen."
		},
		{        
		    "id" : "threshold_flow_accumulation",
		    "args_id" : "accum_threshold",
		    "type": "text",
		    "label": "Threshold Flow Accumluation",
		    "defaultValue": "1000",
		    "required": true,
		    "validText": "^[0-9]+$",
		    "helpText": "The number of upstream cells that must flow into a cell before it's considered part of a stream such that retention stops and the remaining export is exported to the stream. Used to define streams from the DEM."
		},
		{        
		    "id" : "water_purification_threshold_table_uri",
		    "args_id" : "water_purification_threshold_table_uri",
		    "type": "file",
		    "label": "Water Purification Threshold Table",
		    "defaultValue": "../WP_Nutrient_Retention/Input/water_purification_threshold.csv",
		    "required": true,
		    "validateAs": {"type": "CSV",
				   "fieldsExist": ["ws_id"]
				  },
		    "helpText": "A table containing annual nutrient load threshold information.  Must have a ws_id index and thres_n (or p) field depending if nitrogen and/or phosphorous is simulated."
		}
	    ]
	},
	{
	    "id" : "valuation_container",
	    "args_id" : "valuation_enabled",
	    "type" : "container",
	    "label" : "Valuation",
	    "collapsible" : true,
	    "defaultValue" : false,
	    "elements" : [
		{
		    "id" : "valuation_list",
		    "type" : "list",
		    "elements" : [
			{        
			    "id" : "water_purification_valuation_table_uri",
			    "args_id" : "water_purification_valuation_table_uri",
			    "type": "file",
			    "label": "Water Purification valuation table",
			    "defaultValue": "../WP_Nutrient_Retention/Input/water_purification_valuation.csv",
			    "required": true,
			    "validateAs": {"type": "CSV"},
			    "helpText": "The table containing valuation information.  It must be indexed by ws_id and contain fields cost_n (or p), time_span_n (or p), discount_n (or p) depending on which nutrients are selected."
			}
		    ]
		}
	    ]
	}
    ]
}
